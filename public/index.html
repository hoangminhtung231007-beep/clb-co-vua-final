<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>B·∫£ng X·∫øp H·∫°ng CLB C·ªù Vua</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); width: 100%; max-width: 800px; margin-bottom: 20px; }
        canvas { max-height: 300px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #1a2a6c; color: white; padding: 12px; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; }
        .top-1 { background: #fff9c4; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h1 style="text-align: center; color: #1a2a6c;">üèÜ PHONG ƒê·ªò TOP 5 K·ª≤ TH·ª¶</h1>
        <canvas id="eloChart"></canvas>
    </div>

    <div class="card">
        <h1 style="text-align: center;">üìä B·∫¢NG X·∫æP H·∫†NG CHI TI·∫æT</h1>
        <table>
            <thead><tr><th>H·∫°ng</th><th>K·ª≥ th·ªß</th><th>Elo</th><th>C·∫•p b·∫≠c</th></tr></thead>
            <tbody id="data"></tbody>
        </table>
    </div>

    <script>
        let myChart;

        async function load() {
            const res = await fetch('/api/ranking');
            const data = await res.json();
            
            // 1. C·∫≠p nh·∫≠t b·∫£ng x·∫øp h·∫°ng
            document.getElementById('data').innerHTML = data.map((u, i) => `
                <tr class="${i === 0 ? 'top-1' : ''}">
                    <td>${i + 1}</td>
                    <td><b>${u.name}</b> <small>(ID: ${u.id})</small></td>
                    <td style="color:#e67e22; font-weight:bold">${u.elo}</td>
                    <td>${u.rank}</td>
                </tr>
            `).join('');

            // 2. C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì (L·∫•y Top 5)
            const top5 = data.slice(0, 5);
            const ctx = document.getElementById('eloChart').getContext('2d');
            
            if (myChart) myChart.destroy(); // X√≥a bi·ªÉu ƒë·ªì c≈© ƒë·ªÉ v·∫Ω m·ªõi khi c√≥ data thay ƒë·ªïi

            myChart = new Chart(ctx, {
                type: 'bar', // C√≥ th·ªÉ ƒë·ªïi th√†nh 'line' n·∫øu mu·ªën d·∫°ng ƒë∆∞·ªùng
                data: {
                    labels: top5.map(u => u.name),
                    datasets: [{
                        label: 'ƒêi·ªÉm Elo hi·ªán t·∫°i',
                        data: top5.map(u => u.elo),
                        backgroundColor: ['#ffd700', '#c0c0c0', '#cd7f32', '#3498db', '#9b59b6'],
                        borderRadius: 8
                    }]
                },
                options: { 
                    responsive: true,
                    scales: { y: { beginAtZero: false, min: Math.min(...top5.map(u => u.elo)) - 50 } }
                }
            });
        }

        load();
        setInterval(load, 10000); // T·ª± ƒë·ªông l√†m m·ªõi sau 10 gi√¢y
    </script>
</body>
</html>